function pause(){return!1}function drawLines(){0===lineCount&&(calculateCoordinates(),lineCountMax=getMaxLineCount(),lineCount=1);var n=generateLineArray(lineCount);background(0,0,0,50),stroke("grey"),strokeWeight(1+5*audioOsc);for(i=0;i<n.length;i++)t=void 0===n[t=(a=i)-1]?0:t,i>0&&(line(n[a][1].x,n[a][1].y,n[t][1].x,n[t][1].y),line(n[a][0].x,n[a][0].y,n[t][0].x,n[t][0].y),line(n[a][0].x,n[a][0].y,n[a][1].x,n[a][1].y));stroke("white"),strokeWeight(1+5*audioOsc);for(i=0;i<n.length;i++)t=void 0===n[t=(a=i)-1]?0:t,i>0&&(line(n[a][2].x,n[a][2].y,n[t][2].x,n[t][2].y),line(n[a][3].x,n[a][3].y,n[t][3].x,n[t][3].y),line(n[a][2].x,n[a][2].y,n[a][3].x,n[a][3].y));stroke("red"),strokeWeight(1);for(var i=0;i<n.length;i++){var a=i,t=a-1;t=void 0===n[t]?0:t,i>0&&(console.log(n[a]),line(n[a][1].x,n[a][1].y,n[a][3].x,n[a][3].y))}!0===reverse?lineCount--:lineCount++,lineCount<1?(lineCount=0,reverse=!1):lineCount>lineCountMax&&(reverse=!0)}function getMaxLineCount(){return lcm(c0.points,c1.points)+lcm(c2.points,c3.points)+c0.points+c1.points+c2.points+c3.points+c4.points}function calculateCoordinates(){c0.points=60,c1.points=12,c2.points=20,c3.points=4,c4.points=8;for(var n={},i=0;i<circleCount;i++){var a=window["c"+i];a.angle=2*Math.PI/a.points,a.coordinates.setOptions({radius:a.radius,angle:a.angle}),n.c1=a}return n}function generateLineArray(n){for(a=0;a<circleCount;a++)window["c"+a].coordinates.init();for(var i=[],a=0;a<n;a++){for(var t=[],e=0;e<circleCount;e++)window["c"+e].coordinates.move(),t.push({x:window["c"+e].coordinates.pos.x,y:window["c"+e].coordinates.pos.y});i.push(t)}return i}function getRandomBetweenMinAndMax(){var n=Math.round(audioAvgOsc*(abs_max_points-abs_min_points)+abs_min_points),i=Math.round((audioAvgOsc-audioAvgOsc/3)*(abs_max_points/3-abs_min_points)+abs_min_points);return Math.floor(Math.random()*(n-i+1)+abs_min_points)}function analyzeAudioData(n){audio.avgMax=getAvg(average,"max",n.max,50),audio.avgMin=getAvg(average,"min",n.min,50),audio.avgOsc=getAvg(average,"osc",n.osc,50),audio.avgOsc5=getAvg(average,"osc",n.osc,5),audioAvgMax=Math.round(map(audio.avgMax,calibrated.loudness.max,calibrated.silence.max,300,1)),audioMax=map(n.max,calibrated.loudness.max,calibrated.silence.max,300,1),audioAvgMin=Math.round(map(audio.avgMin,calibrated.loudness.min,calibrated.loudness.min,300,1)),audioMin=map(n.min,calibrated.loudness.min,calibrated.silence.min,300,1),audioAvgOsc=map(audio.avgOsc,calibrated.loudness.osc,calibrated.silence.osc,.5,.001),audioOsc=map(audio.avgOsc5,calibrated.loudness.osc,calibrated.silence.osc,.25,0),c0.coordinates.radius=canvasSize*(.45+audioOsc),c1.coordinates.radius=.45*canvasSize,c2.coordinates.radius=.5*canvasSize,c3.coordinates.radius=.4*canvasSize,c4.coordinates.radius=.2*canvasSize}function map(n,i,a,t,e){return i>a?i>n?(n-i)*(e-t)/(a-i)+t:t:a>i?a>n?(n-i)*(e-t)/(a-i)+t:e:void 0}function avg(n){for(var i=0,a=0;a<n.length;a++)i+=n[a];return Math.round(i/n.length)}function max(n){return Math.max.apply(null,n)}function getAvg(n,i,a,t){for(Array.isArray(n[i])||(n[i]=[]);n[i].length>t;)n[i].shift();return n[i].push(a),avg(n[i])}function greatestCommonDivider(n,i){for(;i;){var a=i;i=n%i,n=a}return n}function lcm(n,i){return n=Math.abs(n),i=Math.abs(i),n&&i?Math.abs(n*i/greatestCommonDivider(n,i)):0}function windowResized(){canvasSize=window.innerHeight>window.innerWidth?window.innerWidth:window.innerHeight,createCanvas(window.innerWidth,window.innerHeight)}function keyReleased(n){"k"===n.key&&(console.log("calibrating"),(calibrating=new Calibration(["min","max","osc"])).start(function(n){console.log(n),calibrated=n,calibrating=!1}))}function setup(){window.setupVisual(),window.setupAudio()}function draw(){window.drawVisual(window.drawAudio())}var mic,fft,first,prevMillis,iterator,waveformLength,analyzer,count,vh=1024,vw=1920,measurePoints=1024,measureFreq=1,analyzeFreq=1,avg=function(n){for(var i=0,a=0;a<n.length;a++)i+=n[a];return i/n.length},osc=function(n,i){for(var a=0,t=0,e=0;e<n.length;e++){var o=t;n[e]>i?t=1:n[e]<i&&(t=-1),o!=t&&a++}return a},Analyzer=function(){this.analyze=function(n){var i=avg(n);return{max:Math.max.apply(null,n),min:Math.min.apply(null,n),avg:i,osc:osc(n,i)}},this.measureY=function(n){return(n-=vh/2)<0&&(n=-n),n}};window.setupAudio=function(){analyzer=new Analyzer,(mic=new p5.AudioIn).start(),(fft=new p5.FFT).setInput(mic)},window.drawAudio=function(){var n=fft.waveform();first||(waveformLength=n.length,iterator=parseInt(waveformLength/measurePoints),first=!0);for(var i=[],a=0;a<waveformLength;a+=iterator){var t=map(n[a],-1,1,0,vh);i.push(analyzer.measureY(t))}return analyzer.analyze(i)};var lineCount=0,lineCountMax,reverse=!1,canvasSize,abs_min_points=3,abs_max_points=44,calibrated={silence:{min:0,max:100,avg:20,osc:20},loudness:{min:50,max:300,avg:100,osc:200}},calibrating=!1,average={},audioAvgMax,audioMax,audioAvgMin,audioMin,audioAvgOsc,audioOsc,audio={},circleCount=5;window.setupVisual=function(){canvasSize=window.innerHeight>window.innerWidth?window.innerWidth:window.innerHeight,createCanvas(window.innerWidth,window.innerHeight);for(var n=0;n<circleCount;n++)window["c"+n]={points:void 0,angle:void 0,radius:void 0,coordinates:void 0},window["c"+n].coordinates=new Coordinates({canvas:canvas,radius:window["c"+n].radius,angle:window["c"+n].angle})},window.drawVisual=function(n){audio=n,!1!==calibrating?calibrating.listen(n):analyzeAudioData(n),!1===pause()&&drawLines()};var drawCount=0,drawCountMax=1,Coordinates=function(n){return this.calculate_coordinates=function(n){return n=n||{x:this.canvas.width/2,y:this.canvas.height/2},n.x-=Math.sin(this.i+=this.angle)*this.radius,n.y+=Math.sin(this.j+=this.angle)*this.radius,n},this.move=function(){return this.pos=this.calculate_coordinates(),this},this.init=function(){this.i=0,this.j=Math.PI/2},this.setOptions=function(n){var i=!0;n.radius?this.radius=n.radius:i=!1,n.angle?this.angle=n.angle:i=!1,n.canvas&&(this.canvas=canvas),i&&this.init()},this.setOptions(n),this},Calibration=function(n){this.$alert=document.getElementById("alert"),this.seconds=5,this.silence={},this.loudness={},this.calibrationData={},this.resetCalData=function(){this.calibrationData={};for(var i=0;i<n.length;i++)this.calibrationData[n[i]]=[]},this.calibrateMin=function(i){for(var a=0;a<n.length;a++)this.silence[n[a]]=avg(this.calibrationData[n[a]]);i()},this.calibrateMax=function(i){for(var a=0;a<n.length;a++)this.loudness[n[a]]=max(this.calibrationData[n[a]]),this.silence[n[a]]>this.loudness[n[a]]&&(this.loudness[n[a]]=this.silence[n[a]]+20);i()},this.showInfo=function(n){this.$alert.innerHTML="<h2>Kalibratie</h2><p>"+n+"</p>"},this.calibrateSilence=function(n){this.resetCalData();var i=window.setInterval(function(a){a.seconds>0?(a.seconds--,a.showInfo("Wees stil... "+a.seconds)):(window.clearInterval(i),a.seconds=5,a.calibrateMin(function(){a.calibrateLoudness(n)}))},500,this);this.showInfo("Wees stil... "+this.seconds)},this.calibrateLoudness=function(n){this.resetCalData();var i=window.setInterval(function(a){a.seconds>0?(a.seconds--,a.showInfo("Maak lawaai... "+a.seconds)):(window.clearInterval(i),a.calibrateMax(function(){a.$alert.innerHTML="",n({silence:a.silence,loudness:a.loudness})}))},500,this);this.showInfo("Wees stil... "+this.seconds)},this.start=function(n){this.resetCalData(),this.calibrateSilence(n)},this.listen=function(i){for(var a=0;a<n.length;a++)this.calibrationData[n[a]].push(i[n[a]])}};
